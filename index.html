<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>7-Segment ROM Data Generator for Simulator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Exo+2:wght@400;600;800&display=swap');

        * { box-sizing: border-box; }

        :root {
            --red: #ff2a2a;
            --red-dim: #7a1010;
            --bg: #0d0d0d;
            --panel: #141414;
            --panel2: #1c1c1c;
            --border: #2a2a2a;
            --text: #e0e0e0;
            --green: #00ff88;
            --amber: #ffb300;
        }

        body {
            background: var(--bg);
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px 10px;
            font-family: 'Exo 2', sans-serif;
            color: var(--text);
        }

        .container { width: 100%; max-width: 1100px; }

        header {
            text-align: center;
            padding: 30px 0 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: clamp(1.6rem, 5vw, 2.8rem);
            font-weight: 800;
            letter-spacing: 0.05em;
            color: var(--red);
            text-shadow: 0 0 30px rgba(255,42,42,0.4);
            margin: 0 0 6px;
        }

        header p {
            color: #666;
            margin: 0;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            letter-spacing: 0.15em;
        }

        /* Segment Preview */
        .seg-row {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 24px 0;
            align-items: center;
            flex-wrap: wrap;
        }

        .seg-wrap { text-align: center; }

        .seg-label {
            font-size: 10px;
            letter-spacing: 0.1em;
            color: #555;
            margin-top: 6px;
            font-family: 'Share Tech Mono', monospace;
        }

        canvas.seg {
            display: block;
            background: #080808;
            border: 1px solid #1e1e1e;
            border-radius: 6px;
        }

        /* Segment reference table */
        .seg-ref {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 18px;
            margin-bottom: 20px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 11px;
            color: #666;
            overflow-x: auto;
        }

        .seg-ref h4 { margin: 0 0 8px; color: #444; letter-spacing: 0.1em; font-size: 10px; text-transform: uppercase; }

        .seg-ref table { border-collapse: collapse; }
        .seg-ref td, .seg-ref th { padding: 3px 8px; border: 1px solid #222; text-align: center; white-space: nowrap; }
        .seg-ref th { color: var(--red); background: #1a0000; }
        .seg-ref .ok { color: var(--green); }
        .seg-ref .hi { color: var(--amber); }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .ctrl-group {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
        }

        .ctrl-group h3 {
            margin: 0 0 12px;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            color: #555;
            text-transform: uppercase;
        }

        label {
            display: block;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
            font-family: 'Share Tech Mono', monospace;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 10px 12px;
            background: var(--panel2);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
            font-family: 'Share Tech Mono', monospace;
            margin-bottom: 12px;
            -webkit-appearance: none;
            appearance: none;
        }

        select:focus, input:focus { outline: none; border-color: var(--red); }

        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1 1 180px;
            padding: 13px 18px;
            border: none;
            border-radius: 8px;
            font-size: 0.88rem;
            font-weight: 600;
            font-family: 'Exo 2', sans-serif;
            cursor: pointer;
            transition: all 0.15s;
            letter-spacing: 0.05em;
        }

        .btn-primary { background: var(--red); color: white; }
        .btn-primary:hover { background: #e00; box-shadow: 0 0 20px rgba(255,42,42,0.4); }
        .btn-secondary { background: var(--panel2); color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--red); color: var(--red); }

        .status {
            padding: 10px 16px;
            border-radius: 6px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.82rem;
            margin-bottom: 16px;
            border-left: 3px solid var(--green);
            background: rgba(0,255,136,0.05);
            color: var(--green);
        }

        .preview-box {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .preview-box h3 {
            margin: 0 0 10px;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            color: #555;
            text-transform: uppercase;
        }

        .preview-content {
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            white-space: pre;
            overflow-x: auto;
            overflow-y: auto;
            max-height: 180px;
            color: #00ff88;
            background: #0a0a0a;
            border-radius: 6px;
            padding: 12px;
            line-height: 1.6;
        }

        .table-wrap {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-scroll { max-height: 420px; overflow-y: auto; overflow-x: auto; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; }

        thead th {
            background: #1a0000;
            color: var(--red);
            padding: 10px 12px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 11px;
            letter-spacing: 0.1em;
            position: sticky;
            top: 0;
            border-bottom: 1px solid #2a0000;
            white-space: nowrap;
        }

        td {
            border-bottom: 1px solid #1a1a1a;
            padding: 7px 12px;
            text-align: center;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            color: #aaa;
        }

        tr:hover td { background: #1a1a1a; color: #fff; }
        td strong { color: var(--amber); font-size: 13px; }
        td.disp { color: var(--green); font-weight: bold; font-size: 14px; }

        footer {
            text-align: center;
            padding: 20px 0;
            color: #444;
            font-size: 11px;
            font-family: 'Share Tech Mono', monospace;
            border-top: 1px solid var(--border);
            line-height: 2;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--red-dim); }

        @media (max-width: 500px) { button { flex: 1 1 100%; } }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>7-SEG ROM GENERATOR</h1>
        <p>256×16 · DIGITAL CIRCUIT SIMULATOR · ADDRESSES 0x00–0xFF</p>
    </header>

    <!-- Live segment preview -->
    <div class="seg-row">
        <div class="seg-wrap">
            <canvas class="seg" id="segL" width="80" height="120"></canvas>
            <div class="seg-label">HIGH BYTE (LEFT DIGIT)</div>
        </div>
        <div class="seg-wrap" style="font-size:40px;color:#333;padding-bottom:20px">:</div>
        <div class="seg-wrap">
            <canvas class="seg" id="segR" width="80" height="120"></canvas>
            <div class="seg-label">LOW BYTE (RIGHT DIGIT)</div>
        </div>
    </div>

    <!-- Segment reference -->
    <div class="seg-ref">
        <h4>Segment Bit Mapping (Common Cathode) — bit0=a, bit1=b, bit2=c, bit3=d, bit4=e, bit5=f, bit6=g</h4>
        <table>
            <tr>
                <th>Digit</th>
                <th>a(b0)</th><th>b(b1)</th><th>c(b2)</th><th>d(b3)</th><th>e(b4)</th><th>f(b5)</th><th>g(b6)</th>
                <th>HEX</th><th>Binary</th>
            </tr>
            <tr><td class="hi">0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="hi">3F</td><td>0011 1111</td></tr>
            <tr><td class="hi">1</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td>0</td><td>0</td><td>0</td><td class="hi">06</td><td>0000 0110</td></tr>
            <tr><td class="hi">2</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="hi">5B</td><td>0101 1011</td></tr>
            <tr><td class="hi">3</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td>0</td><td class="ok">1</td><td class="hi">4F</td><td>0100 1111</td></tr>
            <tr><td class="hi">4</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="hi">66</td><td>0110 0110</td></tr>
            <tr><td class="hi">5</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="hi">6D</td><td>0110 1101</td></tr>
            <tr><td class="hi">6</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="hi">7D</td><td>0111 1101</td></tr>
            <tr><td class="hi">7</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td>0</td><td>0</td><td>0</td><td class="hi">07</td><td>0000 0111</td></tr>
            <tr><td class="hi">8</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="hi">7F</td><td>0111 1111</td></tr>
            <tr><td class="hi">9</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="hi">6F</td><td>0110 1111</td></tr>
            <tr><td class="hi">A</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="hi">77</td><td>0111 0111</td></tr>
            <tr><td class="hi">B</td><td>0</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="hi">7C</td><td>0111 1100</td></tr>
            <tr><td class="hi">C</td><td class="ok">1</td><td>0</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="hi">39</td><td>0011 1001</td></tr>
            <tr><td class="hi" style="color:var(--red);font-weight:bold">D</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td>0</td><td class="ok">1</td><td class="hi" style="color:var(--red)">5E</td><td>0101 1110</td></tr>
            <tr><td class="hi">E</td><td class="ok">1</td><td>0</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="hi">79</td><td>0111 1001</td></tr>
            <tr><td class="hi">F</td><td class="ok">1</td><td>0</td><td>0</td><td>0</td><td class="ok">1</td><td class="ok">1</td><td class="ok">1</td><td class="hi">71</td><td>0111 0001</td></tr>
        </table>
    </div>

    <!-- Controls -->
    <div class="controls">
        <div class="ctrl-group">
            <h3>Display Mode</h3>
            <label>Output Format</label>
            <select id="displayMode" onchange="onModeChange()">
                <option value="hex" selected>Hexadecimal (00–FF) — recommended</option>
                <option value="decimal">Decimal (00–99)</option>
                <option value="custom">Custom Range</option>
            </select>
            <label>Segment Type</label>
            <select id="segmentType">
                <option value="commonCathode" selected>Common Cathode (active HIGH)</option>
                <option value="commonAnode">Common Anode (active LOW)</option>
            </select>
        </div>
        <div class="ctrl-group" id="customGroup" style="display:none">
            <h3>Custom Range</h3>
            <label>Start Address (Hex)</label>
            <input type="text" id="startHex" value="00" maxlength="2">
            <label>End Address (Hex)</label>
            <input type="text" id="endHex" value="FF" maxlength="2">
        </div>
    </div>

    <div class="btn-row">
        <button class="btn-primary" onclick="generateROMData()">▶ GENERATE ROM DATA</button>
        <button class="btn-secondary" onclick="copyToClipboard()">⎘ COPY TO CLIPBOARD</button>
        <button class="btn-secondary" onclick="downloadText()">↓ DOWNLOAD .TXT</button>
        <button class="btn-secondary" onclick="downloadCSV()">↓ DOWNLOAD .CSV</button>
    </div>

    <div id="status" class="status">Ready — click GENERATE to build ROM table for 0x00–0xFF</div>

    <div class="preview-box">
        <h3>Preview — First 32 Entries</h3>
        <div class="preview-content" id="preview">// Click GENERATE ROM DATA to begin</div>
    </div>

    <div class="table-wrap">
        <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        <th>ADDR HEX</th>
                        <th>ADDR DEC</th>
                        <th>DISPLAY</th>
                        <th>HI BYTE</th>
                        <th>LO BYTE</th>
                        <th>ROM WORD (16-bit)</th>
                        <th>HI BINARY</th>
                        <th>LO BINARY</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr><td colspan="8" style="color:#444;padding:20px">Generate data to populate table</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <footer>
        7-SEG ROM GENERATOR · 256×16 ROM · COMMON CATHODE ENCODING<br>
        D = 0x5E (0101 1110) · F = 0x71 (0111 0001) · bit0=a · bit1=b · bit2=c · bit3=d · bit4=e · bit5=f · bit6=g
    </footer>
</div>

<script>
    // ═══════════════════════════════════════════════════════════════════════
    //  7-SEGMENT ENCODING — Common Cathode (active HIGH)
    //
    //  Standard bit assignment:
    //    bit 0 = a (top horizontal)
    //    bit 1 = b (top-right vertical)
    //    bit 2 = c (bottom-right vertical)
    //    bit 3 = d (bottom horizontal)
    //    bit 4 = e (bottom-left vertical)
    //    bit 5 = f (top-left vertical)
    //    bit 6 = g (middle horizontal)
    //    bit 7 = DP (decimal point, unused)
    //
    //         aaa
    //        f   b
    //        f   b
    //         ggg
    //        e   c
    //        e   c
    //         ddd
    //
    //  D = 0x5E = 0101 1110
    //    bit1=b ✓  bit2=c ✓  bit3=d ✓  bit4=e ✓  bit6=g ✓
    //    → lowercase d shape (b,c,d,e,g) ✓
    // ═══════════════════════════════════════════════════════════════════════

    const CC = {
        '0': 0x3F,  // 0011 1111  a,b,c,d,e,f
        '1': 0x06,  // 0000 0110  b,c
        '2': 0x5B,  // 0101 1011  a,b,d,e,g
        '3': 0x4F,  // 0100 1111  a,b,c,d,g
        '4': 0x66,  // 0110 0110  b,c,f,g
        '5': 0x6D,  // 0110 1101  a,c,d,f,g
        '6': 0x7D,  // 0111 1101  a,c,d,e,f,g
        '7': 0x07,  // 0000 0111  a,b,c
        '8': 0x7F,  // 0111 1111  a,b,c,d,e,f,g
        '9': 0x6F,  // 0110 1111  a,b,c,d,f,g
        'A': 0x77,  // 0111 0111  a,b,c,e,f,g
        'B': 0x7C,  // 0111 1100  c,d,e,f,g
        'C': 0x39,  // 0011 1001  a,d,e,f
        'D': 0x5E,  // 0101 1110  b,c,d,e,g  (lowercase d shape)
        'E': 0x79,  // 0111 1001  a,d,e,f,g
        'F': 0x71,  // 0111 0001  a,e,f,g
        ' ': 0x00
    };

    // Common Anode = bitwise NOT (8-bit)
    const CA = {};
    for (const k in CC) CA[k] = (~CC[k]) & 0xFF;

    let romData  = [];
    let encoding = CC;

    // ═══════════════════════════════════════════════════════════════════════
    //  CANVAS SEGMENT RENDERER
    //  Draws a 7-segment digit on a canvas element.
    //  Bit mapping matches the CC table above exactly.
    // ═══════════════════════════════════════════════════════════════════════
    function drawSeg(canvas, code) {
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        ctx.clearRect(0, 0, W, H);

        const ON  = '#ff2a2a';
        const OFF = '#1c0000';
        const T = 9;   // segment thickness
        const G = 2;   // gap between segments
        const M = 10;  // margin

        // Layout
        const x1 = M;            // left x
        const x2 = W - M - T;    // right x (for vertical bars)
        const xH = M;            // horizontal bar start x
        const wH = W - 2*M;      // horizontal bar width

        const y1 = M;                          // top row y
        const y2 = M + T + G + (H-2*M-3*T-2*G)/2 + G; // middle row y
        const y3 = H - M - T;                 // bottom row y

        const hV = (H - 2*M - 3*T - 2*G) / 2; // height of each vertical segment

        function glow(on) {
            ctx.shadowColor = on ? ON : 'transparent';
            ctx.shadowBlur  = on ? 10 : 0;
            ctx.fillStyle   = on ? ON : OFF;
        }

        // Draw hexagonal horizontal bar
        function hBar(x, y, w, t) {
            const d = t * 0.38;
            ctx.beginPath();
            ctx.moveTo(x + d,   y);
            ctx.lineTo(x + w - d, y);
            ctx.lineTo(x + w,   y + t/2);
            ctx.lineTo(x + w - d, y + t);
            ctx.lineTo(x + d,   y + t);
            ctx.lineTo(x,       y + t/2);
            ctx.closePath();
            ctx.fill();
        }

        // Draw hexagonal vertical bar
        function vBar(x, y, w, h) {
            const d = w * 0.38;
            ctx.beginPath();
            ctx.moveTo(x + w/2, y);
            ctx.lineTo(x + w,   y + d);
            ctx.lineTo(x + w,   y + h - d);
            ctx.lineTo(x + w/2, y + h);
            ctx.lineTo(x,       y + h - d);
            ctx.lineTo(x,       y + d);
            ctx.closePath();
            ctx.fill();
        }

        // ── Segment a: top horizontal (bit 0) ─────────────────────────────
        glow(code & 0x01);
        hBar(xH, y1, wH, T);

        // ── Segment b: top-right vertical (bit 1) ─────────────────────────
        glow(code & 0x02);
        vBar(x2, y1 + T + G, T, hV);

        // ── Segment c: bottom-right vertical (bit 2) ──────────────────────
        glow(code & 0x04);
        vBar(x2, y2 + T + G, T, hV);

        // ── Segment d: bottom horizontal (bit 3) ──────────────────────────
        glow(code & 0x08);
        hBar(xH, y3, wH, T);

        // ── Segment e: bottom-left vertical (bit 4) ───────────────────────
        glow(code & 0x10);
        vBar(x1, y2 + T + G, T, hV);

        // ── Segment f: top-left vertical (bit 5) ──────────────────────────
        glow(code & 0x20);
        vBar(x1, y1 + T + G, T, hV);

        // ── Segment g: middle horizontal (bit 6) ──────────────────────────
        glow(code & 0x40);
        hBar(xH, y2, wH, T);
    }

    // ═══════════════════════════════════════════════════════════════════════
    //  HELPERS
    // ═══════════════════════════════════════════════════════════════════════
    const hex2 = n => n.toString(16).toUpperCase().padStart(2, '0');
    const bin8 = n => n.toString(2).padStart(8, '0');

    function getCode(ch) {
        return encoding[ch.toUpperCase()] ?? 0x00;
    }

    function onModeChange() {
        document.getElementById('customGroup').style.display =
            document.getElementById('displayMode').value === 'custom' ? 'block' : 'none';
    }

    // ═══════════════════════════════════════════════════════════════════════
    //  GENERATE ROM DATA
    // ═══════════════════════════════════════════════════════════════════════
    function generateROMData() {
        const mode = document.getElementById('displayMode').value;
        const type = document.getElementById('segmentType').value;
        encoding = type === 'commonCathode' ? CC : CA;

        let startAddr = 0, endAddr = 255;

        if (mode === 'decimal') {
            endAddr = 99;
        } else if (mode === 'custom') {
            startAddr = parseInt(document.getElementById('startHex').value, 16) || 0;
            endAddr   = parseInt(document.getElementById('endHex').value,   16) || 255;
            if (startAddr > endAddr) [startAddr, endAddr] = [endAddr, startAddr];
            startAddr = Math.max(0, startAddr);
            endAddr   = Math.min(255, endAddr);
        }

        romData = [];
        let previewStr = '';
        let rows = '';

        for (let addr = startAddr; addr <= endAddr; addr++) {
            let display, leftCh, rightCh;

            if (mode === 'decimal') {
                display = addr.toString().padStart(2, '0');
                leftCh  = display[0];
                rightCh = display[1];
            } else {
                display = hex2(addr);
                leftCh  = display[0];
                rightCh = display[1];
            }

            const hiCode = getCode(leftCh);
            const loCode = getCode(rightCh);
            const word   = hex2(hiCode) + hex2(loCode);

            romData.push({ addr, display, leftCh, rightCh, hiCode, loCode, word });

            if (addr - startAddr < 32) {
                previewStr += `@${hex2(addr)}  ${word}    // ${display}  →  HI:${hex2(hiCode)} LO:${hex2(loCode)}\n`;
            }

            rows += `<tr>
                <td>0x${hex2(addr)}</td>
                <td>${addr}</td>
                <td class="disp">${display}</td>
                <td>${hex2(hiCode)}</td>
                <td>${hex2(loCode)}</td>
                <td><strong>${word}</strong></td>
                <td style="color:#555;font-size:11px">${bin8(hiCode)}</td>
                <td style="color:#555;font-size:11px">${bin8(loCode)}</td>
            </tr>`;
        }

        document.getElementById('preview').textContent  = previewStr;
        document.getElementById('tableBody').innerHTML  = rows;

        if (romData.length > 0) refreshPreviews(romData[0]);

        const status = document.getElementById('status');
        status.textContent = `✓ Generated ${romData.length} entries  |  0x${hex2(startAddr)}–0x${hex2(endAddr)}  |  ${type === 'commonCathode' ? 'Common Cathode' : 'Common Anode'}  |  D=0x${hex2(encoding['D'])}  F=0x${hex2(encoding['F'])}`;

        animateSegPreview(startAddr, Math.min(endAddr, startAddr + 15));
    }

    let previewTimer = null;
    function animateSegPreview(from, to) {
        clearInterval(previewTimer);
        let i = from;
        previewTimer = setInterval(() => {
            if (i > to) { clearInterval(previewTimer); return; }
            const entry = romData.find(e => e.addr === i);
            if (entry) refreshPreviews(entry);
            i++;
        }, 250);
    }

    function refreshPreviews(entry) {
        drawSeg(document.getElementById('segL'), entry.hiCode);
        drawSeg(document.getElementById('segR'), entry.loCode);
    }

    // ═══════════════════════════════════════════════════════════════════════
    //  EXPORT
    // ═══════════════════════════════════════════════════════════════════════
    function copyToClipboard() {
        if (!romData.length) { alert('Generate data first!'); return; }
        let text = '// 7-Segment ROM Data — 256×16\n// @address  WORD (HI_BYTE LO_BYTE)\n\n';
        romData.forEach(e => { text += `@${hex2(e.addr)} ${e.word}\n`; });
        navigator.clipboard.writeText(text).then(() => {
            document.getElementById('status').textContent = '✓ Copied to clipboard — paste directly into simulator ROM editor';
        }).catch(err => alert('Copy failed: ' + err));
    }

    function downloadText() {
        if (!romData.length) { alert('Generate data first!'); return; }
        let text = '// 7-Segment ROM Data — 256×16\n// @address  WORD (HI_BYTE LO_BYTE)\n\n';
        romData.forEach(e => { text += `@${hex2(e.addr)} ${e.word}\n`; });
        trigger(text, 'rom_data.txt', 'text/plain');
        document.getElementById('status').textContent = '✓ rom_data.txt downloaded';
    }

    function downloadCSV() {
        if (!romData.length) { alert('Generate data first!'); return; }
        let csv = 'Address(Hex),Address(Dec),Display,HI Digit,LO Digit,HI Code(Hex),LO Code(Hex),ROM Word,HI Binary,LO Binary\n';
        romData.forEach(e => {
            csv += `0x${hex2(e.addr)},${e.addr},${e.display},${e.leftCh},${e.rightCh},${hex2(e.hiCode)},${hex2(e.loCode)},${e.word},${bin8(e.hiCode)},${bin8(e.loCode)}\n`;
        });
        trigger(csv, 'rom_data.csv', 'text/csv');
        document.getElementById('status').textContent = '✓ rom_data.csv downloaded';
    }

    function trigger(content, filename, mime) {
        const blob = new Blob([content], { type: mime });
        const url  = URL.createObjectURL(blob);
        const a    = document.createElement('a');
        a.href = url; a.download = filename; a.click();
        URL.revokeObjectURL(url);
    }

    // ─── Init ──────────────────────────────────────────────────────────────
    window.onload = () => {
        drawSeg(document.getElementById('segL'), 0x3F);
        drawSeg(document.getElementById('segR'), 0x3F);
        generateROMData();
    };
</script>
</body>
</html>